<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ultimate Calculator (WASM)</title>

<style>
body{
  margin:0;
  background:linear-gradient(180deg,#020617,#0b1324);
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  font-family:system-ui;
  color:white;
}
.calc{
  width:340px;
  background:#0b1324;
  border-radius:22px;
  padding:16px;
  box-shadow:0 40px 80px rgba(0,0,0,.7);
}
.display{
  background:#020617;
  border-radius:14px;
  padding:16px;
  font-size:28px;
  text-align:right;
  min-height:64px;
  overflow-wrap:anywhere;
}
.grid{
  margin-top:16px;
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:12px;
}
button{
  height:58px;
  border:none;
  border-radius:50%;
  font-size:18px;
  color:white;
  background:#1e293b;
}
button.op{background:#334155}
button.equal{
  background:#22c55e;
  color:black;
  grid-row:span 2;
  border-radius:30px;
}
button.clear{background:#ef4444}
button:active{transform:scale(.95)}
</style>
</head>

<body>
<div class="calc">
  <div id="display" class="display">0</div>

  <div class="grid">
    <button class="clear" data-act="clear">C</button>
    <button data-val="(">(</button>
    <button data-val=")">)</button>
    <button class="op" data-val="/">÷</button>

    <button data-val="7">7</button>
    <button data-val="8">8</button>
    <button data-val="9">9</button>
    <button class="op" data-val="*">×</button>

    <button data-val="4">4</button>
    <button data-val="5">5</button>
    <button data-val="6">6</button>
    <button class="op" data-val="-">−</button>

    <button data-val="1">1</button>
    <button data-val="2">2</button>
    <button data-val="3">3</button>
    <button class="op" data-val="+">+</button>

    <button data-val="0">0</button>
    <button data-val=".">.</button>
    <button data-val="%">%</button>
    <button class="equal" data-act="eval">=</button>

    <button data-val="^">^</button>
    <button data-act="back">⌫</button>
  </div>
</div>

<script type="module">
import init, { evaluate } from "./ultimate_calculator_engine.js";

const display = document.getElementById("display");
let expr = "0";

function render(){ display.textContent = expr; }

function add(v){
  if(expr==="0") expr=v;
  else expr+=v;
  render();
}

function clearAll(){ expr="0"; render(); }

function back(){
  expr = expr.length>1 ? expr.slice(0,-1) : "0";
  render();
}

async function run(){
  try{
    expr = evaluate(expr).toString();
    render();
  }catch{
    expr="Error";
    render();
    setTimeout(()=>{expr="0";render()},900);
  }
}

await init();

document.querySelectorAll("button").forEach(b=>{
  if(b.dataset.val) b.onclick=()=>add(b.dataset.val);
  if(b.dataset.act==="clear") b.onclick=clearAll;
  if(b.dataset.act==="back") b.onclick=back;
  if(b.dataset.act==="eval") b.onclick=run;
});
</script>
</body>
</html>
