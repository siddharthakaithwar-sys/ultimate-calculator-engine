<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Scientific Calculator</title>

<style>
/* ===== UI (unchanged dark style) ===== */
body{
  margin:0;
  background:#020a18;
  font-family:system-ui, sans-serif;
  display:flex;
  justify-content:center;
  padding:20px;
  color:#fff;
}
.calculator{
  width:360px;
  background:#06162d;
  border-radius:20px;
  padding:16px;
}
.display{
  background:#030c1a;
  border-radius:16px;
  padding:16px;
  font-size:32px;
  text-align:right;
  overflow-x:auto;
  white-space:nowrap;
}
.mode{
  font-size:14px;
  opacity:.7;
}
.grid{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:10px;
  margin-top:16px;
}
button{
  height:56px;
  border:none;
  border-radius:14px;
  font-size:18px;
  background:#1a2a45;
  color:#fff;
}
button.func{ background:#4da3ff; color:#000; }
button.op{ background:#213657; }
button.clear{ background:#ff5b57; }
button.equal{
  grid-column:span 4;
  height:60px;
  background:#2ecc71;
  font-size:22px;
}
.history{
  margin-top:14px;
  background:#030c1a;
  border-radius:14px;
  padding:10px;
  max-height:140px;
  overflow-y:auto;
}
.history-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.history button{
  background:#ff5b57;
  height:32px;
  font-size:14px;
}
.history-item{
  font-size:14px;
  opacity:.8;
  margin-top:4px;
}
</style>
</head>

<body>
<div class="calculator">

  <div class="display">
    <div class="mode" id="mode">DEG</div>
    <div id="screen">0</div>
  </div>

  <div class="grid">
    <button class="clear">C</button>
    <button id="deg">DEG</button>
    <button>(</button>
    <button>)</button>

    <button class="func">sin</button>
    <button class="func">cos</button>
    <button class="func">tan</button>
    <button class="op">÷</button>

    <button>7</button><button>8</button><button>9</button>
    <button class="op">×</button>

    <button>4</button><button>5</button><button>6</button>
    <button class="op">−</button>

    <button>1</button><button>2</button><button>3</button>
    <button class="op">+</button>

    <button>0</button>
    <button>.</button>
    <button>⌫</button>
    <button>%</button>

    <button>^</button>
    <button class="equal">=</button>
  </div>

  <div class="history">
    <div class="history-header">
      <span>History</span>
      <button id="clearHistory">Clear</button>
    </div>
    <div id="historyList"></div>
  </div>

</div>

<script>
/* ===== STATE ===== */
let expr = "";
let history = [];
let isDeg = true;

const screen = document.getElementById("screen");
const historyList = document.getElementById("historyList");
const mode = document.getElementById("mode");

/* ===== UTILS ===== */
const toRad = x => isDeg ? x * Math.PI / 180 : x;

function format(n){
  if(!isFinite(n)) return "Error";
  if(Math.abs(n) > Number.MAX_SAFE_INTEGER) return "Overflow";
  let s = n.toString();
  if(s.includes("e")) return n.toFixed(12).replace(/\.?0+$/,"");
  return s;
}

function update(){
  screen.textContent = expr || "0";
  screen.scrollLeft = screen.scrollWidth;
}

/* ===== PARSER ===== */
function evaluateExpression(raw){
  let e = raw;

  e = e.replace(/×/g,"*").replace(/÷/g,"/").replace(/−/g,"-");

  /* % : A%B => (A/100)*B */
  e = e.replace(/(\d+(\.\d+)?)[%](\d+(\.\d+)?)/g,"($1/100*$3)");

  /* power */
  e = e.replace(/(\d+(\.\d+)?)\^(\d+(\.\d+)?)/g,"Math.pow($1,$3)");

  /* trig */
  e = e.replace(/sin\(([^)]+)\)/g,(_,x)=>`Math.sin(${toRad(Number(x))})`);
  e = e.replace(/cos\(([^)]+)\)/g,(_,x)=>`Math.cos(${toRad(Number(x))})`);
  e = e.replace(/tan\(([^)]+)\)/g,(_,x)=>`Math.tan(${toRad(Number(x))})`);

  return Function(`"use strict"; return (${e})`)();
}

/* ===== HISTORY ===== */
function renderHistory(){
  historyList.innerHTML = history
    .map(h=>`<div class="history-item">${h}</div>`).join("");
}

/* ===== INPUT ===== */
document.querySelectorAll("button").forEach(b=>{
  const t = b.textContent.trim();

  b.onclick = ()=>{
    if(t==="C"){ expr=""; update(); return; }

    if(t==="="){
      try{
        const res = format(evaluateExpression(expr));
        history.unshift(`${expr} = ${res}`);
        history = history.slice(0,20);
        expr = res==="Error"||res==="Overflow" ? "" : res;
        renderHistory();
      }catch{
        expr="Error";
      }
      update(); return;
    }

    if(t==="⌫"){ expr = expr.slice(0,-1); update(); return; }

    if(t==="DEG"){
      isDeg=!isDeg;
      mode.textContent=isDeg?"DEG":"RAD";
      return;
    }

    if(t==="Clear"){ history=[]; renderHistory(); return; }

    if(["sin","cos","tan"].includes(t)){
      expr += t+"(";
      update(); return;
    }

    expr += t;
    update();
  };
});

document.getElementById("clearHistory").onclick=()=>{
  history=[];
  renderHistory();
};

update();
</script>
</body>
</html>
