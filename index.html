<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Ultimate Calculator (WASM)</title>

<style>
:root{
  --bg:#0b1324;
  --panel:#111b2e;
  --btn:#1e2a44;
  --op:#2b3b5f;
  --green:#2ecc71;
  --red:#e74c3c;
  --text:#ffffff;
}
*{box-sizing:border-box;font-family:system-ui;}
body{
  margin:0;
  background:linear-gradient(180deg,#050b18,#0b1324);
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  color:var(--text);
}
.calc{
  width:340px;
  background:var(--panel);
  border-radius:22px;
  padding:16px;
  box-shadow:0 30px 80px rgba(0,0,0,.6);
}
.display{
  background:#050b18;
  border-radius:14px;
  padding:14px;
  min-height:64px;
  text-align:right;
  font-size:28px;
  overflow-wrap:anywhere;
}
.grid{
  margin-top:16px;
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:12px;
}
button{
  height:58px;
  border:none;
  border-radius:50%;
  font-size:18px;
  color:var(--text);
  background:var(--btn);
}
button.op{background:var(--op)}
button.equal{
  background:var(--green);
  color:#000;
  grid-row:span 2;
  border-radius:30px;
}
button.clear{background:var(--red)}
button:active{transform:scale(.95)}
</style>
</head>

<body>
<div class="calc">
  <div id="display" class="display">0</div>

  <div class="grid">
    <button class="clear" data-act="clear">C</button>
    <button data-val="(">(</button>
    <button data-val=")">)</button>
    <button class="op" data-val="/">÷</button>

    <button data-val="7">7</button>
    <button data-val="8">8</button>
    <button data-val="9">9</button>
    <button class="op" data-val="*">×</button>

    <button data-val="4">4</button>
    <button data-val="5">5</button>
    <button data-val="6">6</button>
    <button class="op" data-val="-">−</button>

    <button data-val="1">1</button>
    <button data-val="2">2</button>
    <button data-val="3">3</button>
    <button class="op" data-val="+">+</button>

    <button data-val="0">0</button>
    <button data-val=".">.</button>
    <button data-act="back">⌫</button>
    <button class="equal" data-act="eval">=</button>
  </div>
</div>

<script type="module">
import init, { evaluate } from "./ultimate_calculator_engine.js";

const display = document.getElementById("display");
let expr = "0";

function update(){ display.textContent = expr; }

function append(v){
  if(expr==="0") expr=v;
  else expr+=v;
  update();
}

function clearAll(){
  expr="0"; update();
}

function back(){
  expr = expr.length>1 ? expr.slice(0,-1) : "0";
  update();
}

async function calc(){
  try{
    const res = evaluate(expr);
    expr = res.toString();
    update();
  }catch(e){
    expr="Error";
    update();
    setTimeout(()=>{expr="0";update()},800);
  }
}

await init();

document.querySelectorAll("button").forEach(b=>{
  if(b.dataset.val)
    b.onclick=()=>append(b.dataset.val);
  if(b.dataset.act==="clear")
    b.onclick=clearAll;
  if(b.dataset.act==="back")
    b.onclick=back;
  if(b.dataset.act==="eval")
    b.onclick=calc;
});
</script>
</body>
</html>
